k<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Admin Cashless</title>
</head>
<body>
    <h1>ğŸ›ï¸ Interface Admin - Utilisateurs RFID</h1>

    {% if error %}
        <p style="color: red;">{{ error }}</p>
    {% endif %}

    <!-- Formulaire pour ajouter un utilisateur -->
    <h2>â• Ajouter un utilisateur</h2>
    <form method="post" action="/admin/add">
        Nom : <input type="text" name="name" required>
        UID RFID : <input type="text" name="rfid_uid" required>
        Solde initial (â‚¬) : <input type="number" name="balance" step="0.01" required>
        <button type="submit">Ajouter</button>
    </form>

    <hr>

    <!-- Liste des utilisateurs -->
    <h2>ğŸ‘¥ Utilisateurs enregistrÃ©s</h2>
    <table border="1" cellpadding="6">
        <tr>
            <th>ID</th>
            <th>Nom</th>
            <th>UID</th>
            <th>Solde (â‚¬)</th>
            <th>Actions</th>
        </tr>
        {% for user in users %}
        <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.name }}</td>
            <td>{{ user.rfid_uid }}</td>
            <td>{{ '%.2f' % user.balance }}</td>
            <td>
                <!-- Recharge -->
                <form method="post" action="/admin/recharge" style="display:inline;">
                    <input type="hidden" name="user_id" value="{{ user.id }}">
                    <input type="number" name="amount" step="0.01" placeholder="â‚¬" required>
                    <button type="submit">ğŸ’° Recharger</button>
                </form>
                <!-- DÃ©biter -->
                <form method="post" action="/admin/pay" style="display:inline;">
                    <input type="hidden" name="user_id" value="{{ user.id }}">
                    <input type="number" name="amount" step="0.01" placeholder="â‚¬" required>
                    <button type="submit">â– DÃ©biter</button>
                </form>
            </td>
        </tr>
        <tr>
            <td colspan="5">
                <details>
                    <summary>ğŸ“œ Voir les transactions</summary>
                    {% set txs = user_transactions[user.id] %}
                    {% if txs %}
                        <ul>
                        {% for tx in txs %}
                            <li>
                                {{ tx.timestamp.strftime('%Y-%m-%d %H:%M:%S') }} :
                                {{ tx.type }} de {{ tx.amount }} â‚¬
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <em>Aucune transaction</em>
                    {% endif %}
                </details>
            </td>
        </tr>
        {% endfor %}
    </table>

    <hr>

    <h2>ğŸ§° Outils Admin</h2>
    <form action="/admin/reset-balances" method="post">
        <button type="submit">ğŸ” RÃ©initialiser tous les soldes</button>
    </form>
    <form action="/admin/reset-transactions" method="post">
        <button type="submit">ğŸ§¾ Supprimer toutes les transactions</button>
    </form>
    <form action="/admin/reset" method="post">
        <button type="submit" style="color: red;">ğŸ’¥ Supprimer tous les utilisateurs</button>
    </form>
    <form action="/admin/export-balances" method="get">
        <button type="submit">ğŸ“¥ Export CSV des soldes</button>
    </form>

    <hr>

    <a href="/logout">ğŸšª Se dÃ©connecter</a>
</body>
</html>

